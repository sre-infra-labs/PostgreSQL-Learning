server = false

datacenter = "{{ consul_server.datacenter }}"
domain = "{{ consul_server.domain }}"
data_dir = "/opt/consul"
encrypt = "{{ consul_server.encrypt }}"
log_file = "/var/log/consul/consul.log"

tls {
  defaults {
    ca_file = "/etc/consul.d/certs/consul-agent-ca.pem"

    verify_incoming = false
    verify_outgoing = true
  }
  internal_rpc {
    verify_server_hostname = false
  }
}

auto_encrypt {
  tls = true
}

acl {
  enabled = true
  default_policy = "deny"
  down_policy = "extend-cache"
  enable_token_persistence = true
  tokens = {
    default = "{{ consul_master_token }}"
    agent   = "{{ consul_node_token }}"
  }
}

node_name      = "{{ inventory_hostname }}"   # Name of client host
bind_addr      = "{{ ip }}"             # IP of client host
advertise_addr = "{{ ip }}"             # IP of client host

client_addr = "0.0.0.0"
retry_join  = ["{{ consul_server.ip }}","{{ consul_server.name }}"]  # IP of Consul server

enable_script_checks = true
