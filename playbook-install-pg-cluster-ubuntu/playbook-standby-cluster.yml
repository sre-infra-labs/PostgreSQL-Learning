---
- name: Deploy Standby Cluster on Redhat hosts
  hosts: all
  become: true
  become_user: root
  remote_user: ansible
  gather_facts: true
  vars:
    # ansible_become_flags: "-H -S"
  vars_files:
    - sensitive-values
    - vars/dba_vars.yml
  collections:
    - community.postgresql

  pre_tasks:
    - name: Starting Playbook Execution
      debug:
        msg: "ðŸš€ Starting PostgreSQL Cluster installation and configuration!"

  roles:
    - role: standby_cluster
      # when: ansible_host in groups['redhat']

  post_tasks:
    - name: Playbook Execution Completed
      debug:
        msg: "âœ… PostgreSQL Cluster installation and configuration completed successfully!"

# ansible-playbook -i hosts__standby_cluster.yml playbook-standby-cluster.yml --vault-password-file=vault-pass

# ansible dc2 -i hosts__multi_datacenter.yml -u ansible -b -m service -a "name=postgresql@17-main state=stopped"
# ansible dc2 -i hosts__multi_datacenter.yml -u ansible -b -m service -a "name=patroni state=stopped"
# ansible dc2 -i hosts__multi_datacenter.yml -u ansible -b -m shell -a "rm -rf /var/lib/postgresql/17/main"

# ansible dc2_leader -i hosts__multi_datacenter.yml -u ansible -b -m shell -a "patronictl -c /etc/patroni/patroni.yml list"
